apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-init-scripts
data:
  init.sql: |+
    -- Este script se ejecutará automáticamente la primera vez que el contenedor de MySQL se inicie.

    -- Crear la tabla de estudiantes
    CREATE TABLE IF NOT EXISTS estudiantes (
      id INT AUTO_INCREMENT PRIMARY KEY,
      nombre VARCHAR(100) NOT NULL,
      correo VARCHAR(100) NOT NULL UNIQUE
    );

    -- Crear la tabla de preguntas
    CREATE TABLE IF NOT EXISTS preguntas (
      id INT AUTO_INCREMENT PRIMARY KEY,
      texto TEXT NOT NULL,
      categoria VARCHAR(50)
    );

    -- Crear la tabla de respuestas
    CREATE TABLE IF NOT EXISTS respuestas (
      id INT AUTO_INCREMENT PRIMARY KEY,
      estudiante_id INT NOT NULL,
      pregunta_id INT NOT NULL,
      respuesta VARCHAR(10) NOT NULL,
      fecha_respuesta TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (estudiante_id) REFERENCES estudiantes(id) ON DELETE CASCADE,
      FOREIGN KEY (pregunta_id) REFERENCES preguntas(id) ON DELETE CASCADE
    );

    -- Crear la tabla de resultados
    CREATE TABLE IF NOT EXISTS resultados_vocacionales (
      id INT AUTO_INCREMENT PRIMARY KEY,
      estudiante_id INT NOT NULL,
      resultado TEXT NOT NULL,
      fecha TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (estudiante_id) REFERENCES estudiantes(id)
    );

    -- Insertar preguntas base. Usamos INSERT IGNORE para evitar errores si se ejecuta más de una vez.
    INSERT IGNORE INTO `preguntas` (`id`, `texto`, `categoria`) VALUES
    (1, '¿Disfrutas trabajando con números y datos?', 'Realista')